<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lichess Insights Dashboard</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
        input, button { padding: 10px; margin: 10px; }
        canvas { margin-top: 20px; max-width: 100%; }
    </style>
</head>
<body>
    <h2>Lichess Insights Dashboard</h2>
    
    <input type="text" id="apiKey" placeholder="Enter your Lichess API Key">
    <button onclick="fetchData()">Fetch Data</button>

    <div id="userInfo"></div>
    <canvas id="ratingChart"></canvas>

    <script>
        async function fetchData() {
            const apiKey = document.getElementById("apiKey").value.trim();
            if (!apiKey) {
                alert("lip_mJ4jrl9DySD0TRZoz6Ox");
                return;
            }

            try {
                const response = await fetch("https://lichess.org/api/account", {
                    headers: { "Authorization": "Bearer " + apiKey }
                });

                if (!response.ok) {
                    throw new Error("Invalid API Key or Request Blocked");
                }

                const data = await response.json();
                document.getElementById("userInfo").innerHTML = `
                    <h3>${data.username} (${data.title || "No Title"})</h3>
                    <p>Online: ${data.online ? "✅ Yes" : "❌ No"}</p>
                    <p>Ratings: Blitz (${data.perfs.blitz.rating}), Rapid (${data.perfs.rapid.rating}), Bullet (${data.perfs.bullet.rating})</p>
                `;

                fetchRatingHistory(data.username, apiKey);
            } catch (error) {
                alert(error.message);
            }
        }

        async function fetchRatingHistory(username, apiKey) {
            try {
                const response = await fetch(`https://lichess.org/api/user/${username}/rating-history`, {
                    headers: { "Authorization": "Bearer " + apiKey }
                });

                if (!response.ok) throw new Error("Rating data unavailable");

                const historyData = await response.json();
                const rapidHistory = historyData.find(h => h.name === "Rapid");

                if (!rapidHistory) {
                    alert("No Rapid rating data found.");
                    return;
                }

                const dates = rapidHistory.points.map(p => new Date(p[0] * 1000).toLocaleDateString());
                const ratings = rapidHistory.points.map(p => p[1]);

                drawChart(dates, ratings);
            } catch (error) {
                alert(error.message);
            }
        }

        function drawChart(labels, data) {
            const ctx = document.getElementById("ratingChart").getContext("2d");
            new Chart(ctx, {
                type: "line",
                data: {
                    labels: labels,
                    datasets: [{ label: "Rapid Rating", data: data, borderColor: "blue", fill: false }]
                }
            });
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</body>
</html>
